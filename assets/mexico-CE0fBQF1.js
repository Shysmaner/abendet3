var Me=Object.defineProperty;var Te=(S,y,t)=>y in S?Me(S,y,{enumerable:!0,configurable:!0,writable:!0,value:t}):S[y]=t;var c=(S,y,t)=>Te(S,typeof y!="symbol"?y+"":y,t);import{R as p,g as Le,j as s,r as A,c as Ue}from"./country-D3IyiI93.js";/* empty css                  *//* empty css              *//* empty css                       */import{c as Oe,a as Be}from"./cookies-DJwG0iie.js";import{a as Fe,c as $e}from"./axios-BE9_Wk52.js";import{g as qe,o as q}from"./index-454a0f5f-BXqj5mO1.js";import{g,q as T,w as N,c as j,b as v,d as m,e as u,u as w,s as B,f as ze,h as _,T as Y,r as D,i as L,j as R,k as We,l as Ve,m as X,a as He,n as J}from"./firebase-CbjSvAAB.js";/* empty css                       */const b=qe(He);class Qe extends p.Component{constructor(t){super(t);c(this,"getDeliveryWorkerZone",async t=>{try{const a=await g(t);if(a.exists()){const i=a.data().zone;return i?(console.log("La zona del trabajador de entrega es:",i),i):(console.log("El campo 'zone' no está presente en el documento."),null)}else return console.log("El documento no existe."),null}catch(a){return console.error("Error obteniendo la zona del trabajador de entrega:",a),null}});c(this,"fetchPendingPurchases",async()=>{const t=T(j(u,"purchases"),N("deliveryDate","==","pendiente")),o=(await v(t)).docs.map(i=>({id:i.id,...i.data()}));this.setState({purchases:o})});c(this,"assignDeliveryDate",async(t,a)=>{try{const o=m(u,"purchases",t);await w(o,{deliveryDate:a}),this.setState(i=>({purchases:i.purchases.map(l=>l.id===t?{...l,deliveryDate:a}:l)}))}catch(o){console.error("Error assigning delivery date:",o)}});c(this,"navigateTo",t=>{window.location.href=t});c(this,"searchAppear",()=>{window.scrollTo({top:0,behavior:"smooth"}),this.searchDivRef.current.classList.toggle("search-appear")});c(this,"handleSearchIconClick",()=>{const t=this.searchInputRef.current;t.value===""?t.placeholder=this.state.searchPlaceholder:(localStorage.setItem("input-value",t.value),window.location.href="search/index.html")});c(this,"handleRightArrowClick",()=>{const t=this.rightArrowRef.current,a=this.mobileContentRef.current;t.classList.toggle("rotation"),a.classList.add("shaking2"),setTimeout(()=>{a.classList.toggle("shaking1"),setTimeout(()=>{a.classList.toggle("shaking2")},200),setTimeout(()=>{a.classList.toggle("visibility")},200)},200)});c(this,"handleSearchInputKeyPress",t=>{t.keyCode===13&&this.handleSearchIconClick()});c(this,"handleAcceptCookies",()=>{Be(),this.setState({cookiesAccepted:!0})});c(this,"handlePasswordChangeClick",()=>{const t=this.newPasswordInputRef.current.value,a=this.currentPasswordRef.current.value;$e(t,a).then(()=>{this.setState({showChangePasswordMessage:!0}),this.setState({errorMessageChangingPassword:!1}),setTimeout(()=>{window.location.href=""},1e3)}).catch(o=>{this.setState({errorMessageChangingPassword:!0}),this.setState({showChangePasswordMessage:!1})})});c(this,"logOut",()=>{b.signOut().then(()=>{console.log("Sesión cerrada"),window.location.href="../../"}).catch(t=>{console.error("Error al cerrar sesión",t)})});c(this,"handleOnChange",t=>{this.setState({progress:!0});const a=t.target.files[0];q(b,o=>{if(o){let i=D(R,`pictures/${o.uid}`),l=J(i,a);l.on("state_changed",d=>{const n=d.bytesTransferred/d.totalBytes*100;this.setState({uploadValue:n})},d=>{this.setState({message:`Ha ocurrido un error: ${d.message}`})},()=>{L(l.snapshot.ref).then(d=>{setTimeout(()=>{window.location.href=""},500),this.setState({progress:!1}),this.setState({picture:d,message:"¡Foto de perfil actualizada!",fileUploadButtonText:"Subir"})}).catch(d=>{console.error("Error al obtener la URL de descarga",d)})})}}),t.target.files.length>0?this.setState({fileUploadButtonText:`Archivo seleccionado: ${t.target.files[0].name}`}):this.setState({fileUploadButtonText:"Subir"})});c(this,"handleModifyAddress",async(t,a)=>{this.setState({modifyAddressForm:!0,showAddresses:!1,selectedAddress:t,addressIndex:a,userInfo:!1})});c(this,"handleModifyAddressOnDB",async(t,a)=>{const{selectedAddress:o}=this.state;t=o;try{const i=m(u,"addresses",a),n=(await g(i)).data().addresses||[],f=n[this.state.addressIndex],x=n.filter((k,C)=>C!==this.state.addressIndex);await w(i,{addresses:x}),await B(m(u,"addresses",a),{addresses:ze(t)},{merge:!0}),console.log("Address saved successfully:",t),this.setState({addresses:x}),console.log("Address deleted successfully:",f),window.location.href=""}catch(i){throw console.error("Error saving address:",i),i}});c(this,"handleInputChange",(t,a)=>{this.setState(o=>({selectedAddress:{...o.selectedAddress,[t]:a}}))});c(this,"handleCloseModifyAddressForm",()=>{this.setState({modifyAddressForm:!1})});c(this,"handleDeleteAddress",async(t,a)=>{this.setState({selectedAddress:t,addressIndex:a});try{const{userId:o}=this.state,i=m(u,"addresses",o),n=(await g(i)).data().addresses||[],f=n[this.state.addressIndex],x=n.filter((k,C)=>C!==this.state.addressIndex);await w(i,{addresses:x}),console.log("Address deleted successfully:",f),window.location.href=""}catch(o){throw o}});c(this,"handleUserClick",async t=>{this.setState({salesList:!0});try{const a=T(j(u,"purchases"),N("userId","==",t),N("deliveryDate","==","pendiente")),i=(await v(a)).docs.map(l=>({id:l.id,timestamp:l.data().timestamp,items:l.data().items,canceled:l.data().canceled,inTheWay:l.data().inTheWay,deliveryDate:l.data().deliveryDate}));this.setState({purchaseHistory:i})}catch(a){console.error("Error fetching purchase history:",a)}});c(this,"handleLoadAllPendingPurchases",async()=>{this.setState({isLoading:!0});try{const t=T(j(u,"purchases"),N("canceled","==","no"),N("delivered","==","no"),N("inReturnProcess","==","no"),N("returned","==","no"),N("zone","==",this.state.deliveryWorkerZone)),o=(await v(t)).docs.map(i=>({id:i.id,timestamp:i.data().timestamp,items:i.data().items,canceled:i.data().canceled,delivered:i.data().delivered,inReturnProcess:i.data().inReturnProcess,returned:i.data().returned,inTheWay:i.data().inTheWay,deliveryDate:i.data().deliveryDate}));this.setState({purchaseHistory:o,isLoading:!1})}catch(t){console.error("Error fetching purchase history:",t),this.setState({isLoading:!1})}});c(this,"handleLoadPurchase",async(t,a)=>{try{const i=(await g(m(u,"purchases",t))).data(),l=i.items||[],d=i.address||{};this.setState({purchaseDataToDownloadTicket:i,purchaseIdToDownloadTicket:t}),this.setState({selectedPurchaseItems:l,selectedPurchaseAddress:d,payerName:i.payerName,deliveryDate:i.deliveryDate})}catch(o){console.error("Error loading purchase items:",o)}});c(this,"formatDate",t=>{const a=new Date(t),o={day:"numeric",month:"long",year:"numeric"};return a.toLocaleDateString("es-ES",o)});c(this,"handleFilter",()=>{this.fetchPendingPurchases(),this.setState({salesList:!1})});c(this,"schroll",()=>{window.scrollTo({top:0,behavior:"smooth"})});c(this,"handleAddAddressBtnFromUserInfo",t=>{this.state.addressesShow.length>=3?(this.setState({noMoreAddressesMsg:!0}),this.schroll(),e.preventDefault()):(window.location.href="products/index.html",localStorage.setItem("open-add-direction",!0))});c(this,"handleUsersListClick",()=>{this.setState({users:!0,userInfo:!1,salesList:!1,sales:!1,userPicture:"../../src/assets/pfp.png"}),this.fetchUsers()});c(this,"handleAdminActionsClick",t=>{this.setState(a=>({adminActions:a.adminActions===t?null:t}))});c(this,"handleInputChange2",t=>{const{name:a,value:o}=t.target;this.setState({[a]:o})});c(this,"sendMessage",async t=>{t.preventDefault();const{receiverId:a,subject:o,message:i}=this.state,l=this.state.currentUserUID;try{await _(j(u,"messages"),{senderId:l,receiverId:a,subject:o,message:i,timestamp:Y.fromDate(new Date),read:"false"}),this.setState({receiverId:"",subject:"",message:"",messageUserForm:!1})}catch{}});c(this,"handleMessageUser",t=>{this.setState({users:!1,messageUserForm:!0,receiverId:t,adminActions:!1,userInfo:!1},()=>{const{receiverId:a}=this.state,o=D(R,`pictures/${a}`);L(o).then(i=>{this.setState({userPicture:i})}).catch(i=>{})})});c(this,"handleShowMessages",()=>{window.scrollTo({top:0,behavior:"smooth"}),this.setState({userMessages:!0})});c(this,"handleMessageClick",async t=>{try{const a=m(u,"messages",t),o=await g(a);if(o.exists()){const i=o.data();await w(a,{read:"true"});const l=i.subject||"No Subject",d=i.message||"No Message",n=i.senderId||"No sender",f=i.email||"No email";this.setState({messageShow:!0,messageSubject:l,messageMessage:d,messageSender:n,messageEmail:f})}else console.log("El documento no existe.")}catch(a){console.error("Error loading message:",a),console.log("Hubo un error al cargar el mensaje.")}});c(this,"handleCloseMessageClick",()=>{this.setState({messageShow:!1}),this.fetchMessages()});c(this,"handleCloseMessagesWindow",()=>{this.setState({userMessages:!1}),this.fetchMessages()});c(this,"handleReplay",t=>{this.setState({messageBackForm:!0,userMessages:!1,messageShow:!1,messageSender:t})});c(this,"sendMessageBack",async t=>{t.preventDefault();const{subject:a,message:o}=this.state,i=this.state.messageSender,l=this.state.currentUserUID;try{await _(j(u,"messages"),{senderId:l,receiverId:i,subject:a,message:o,timestamp:Y.fromDate(new Date),read:"false",email:b.currentUser.email}),this.setState({receiverId:"",subject:"",message:"",messageBackForm:!1})}catch{}});c(this,"userSearch",t=>{const a=t.target.value.toLowerCase();document.querySelectorAll("li").forEach(o=>{a===""?(o.style.setProperty("background","none"),o.style.setProperty("display","block")):o.textContent.toLowerCase().includes(a)?(o.style.setProperty("background","#ccc"),o.style.setProperty("display","block")):(o.style.setProperty("background","none"),o.style.setProperty("display","none"))})});c(this,"handleAppearUserInfo",()=>{this.schroll(),this.setState({userInfo:!0,users:!1,sales:!1,messageUserForm:!1})});c(this,"updateOnlineStatus",()=>{this.setState({offlineMessage:!navigator.onLine})});c(this,"updatePurchaseStatus",async(t,a)=>{try{const o=m(u,"purchases",t),i={delivered:a==="Entregado"?"yes":"no",inTheWay:a==="En envío"?"yes":"no"};await w(o,i),console.log("Estado actualizado para el purchaseId:",t,i),this.handleLoadAllPendingPurchases()}catch(o){console.error("Error updating purchase status:",o)}});c(this,"handleOnChangeOnProductImg",t=>{this.setState({progress:!0});const a=t.target.files[0],o=a.name;q(b,i=>{if(i){let l=D(R,`images/${o}`),d=J(l,a);d.on("state_changed",n=>{const f=n.bytesTransferred/n.totalBytes*100;this.setState({uploadValue2:f})},n=>{this.setState({message:`Ha ocurrido un error: ${n.message}`,progress:!1})},()=>{this.setState({message2:"¡Subida completada!"}),L(d.snapshot.ref).then(n=>{this.setState({progress:!1,productImgUrl:n})}).catch(n=>{this.setState({message:`Error al obtener la URL: ${n.message}`,progress:!1})})})}else this.setState({message:"No se ha autenticado al usuario.",progress:!1})})});c(this,"handleSaveProduct",async t=>{t.preventDefault();try{if(!this.typeOfProductRef.current.value||!this.productName.current.value||!this.productStock.current.value||!this.productCategory.current.value||!this.productComments.current.value||!this.productPrice.current.value||!this.state.productImgUrl){this.setState({addProductErrorMessage:!0}),setTimeout(()=>{this.setState({addProductErrorMessage:!1})},2e3);return}const a=await v(j(u,"products"));let o=-1;a.forEach(n=>{const f=parseInt(n.id,10);f>o&&(o=f)});const i=o+1,l=m(j(u,"products"),i.toString()),d={productId:i.toString(),type:this.typeOfProductRef.current.value,name:this.productName.current.value,stock:parseInt(this.productStock.current.value,10),category:this.productCategory.current.value,comments:this.productComments.current.value,price:parseFloat(this.productPrice.current.value).toFixed(2),rating:"",imageUrl:this.state.productImgUrl};await B(l,d),this.setState({addProductDoneMessage:!0}),setTimeout(()=>{this.setState({addProductDoneMessage:!1})},2e3),this.setState({productAddedCorrectly:!0})}catch(a){console.error("Error al guardar el producto: ",a)}});c(this,"handleManageProductsBtnClick",async()=>{this.setState({manageProducts:!0,products:[],productsLoaded:!1});try{const t=T(j(u,"products")),o=(await v(t)).docs.map(i=>({id:i.id,...i.data()}));this.setState({products:o,productsLoaded:!0})}catch(t){console.error("Error loading products:",t),this.setState({productsLoaded:!1})}});c(this,"handleProductClick",async(t,a)=>{try{this.setState({selectedProduct:!0,manageProducts:!1,productSelectedId:t,pictureToRemove:a});const o=await g(m(u,"products",t)),i=o.data(),l=i.name||{},d=i.stock||{},n=i.imageUrl||{},f=i.type||{},x=i.category||{},k=i.comments||{},C=o.id||{};this.setState({productName:l,productStock:d,productImageUrl:n,productType:f,productCategory:x,productComments:k,selectedProductId:C})}catch(o){console.error("Error en handleProductClick: ",o)}});c(this,"handleModifyProductName",async t=>{try{const a=m(u,"products",t);(await g(a)).exists()?(await w(a,{name:this.productToModifyName.current.value}),alert("Nombre actualizado correctamente"),window.location.href=""):console.error("No such product!")}catch(a){console.error("Error updating product:",a)}});c(this,"handleModifyProductType",async t=>{try{const a=m(u,"products",t);(await g(a)).exists()?(await w(a,{type:this.productToModifyType.current.value}),alert("Tipo de producto actualizado exitosamente."),this.setState({modifyProductTypeInput:!1}),window.location.href=""):console.error("No such product!")}catch(a){console.error("Error updating product type:",a),alert("Hubo un error al actualizar el tipo de producto.")}});c(this,"handleModifyProductStock",async t=>{try{const a=m(u,"products",t);(await g(a)).exists()?(await w(a,{stock:this.productToModifyStock.current.value}),alert("Stock del producto actualizado correctamente."),window.location.href=""):console.error("No such product!")}catch(a){console.error("Error updating product:",a)}});c(this,"handleModifyProductImage",async(t,a,o)=>{try{const l=`images/${a.split("?")[0].split("%2F").pop()}`,d=D(R,l);await We(d),console.log(`Image deleted successfully: ${l}`);const n=D(R,`images/${o.name}`),f=await Ve(n,o);console.log("New image uploaded successfully:",f.metadata.name);const x=await L(n);console.log("New image URL:",x),await w(m(u,"products",t),{imageUrl:x}),console.log("Firestore updated with new image URL."),alert("Imágen actualizada correctamente"),window.location.href=""}catch(i){console.error("Error replacing image:",i),alert("Error replacing image. Please try again.")}});c(this,"handleSearchOnChangeOnRoles",(t,a)=>{if(a===""){switch(t){case"admins":this.setState({filteredAdmins:this.state.adminsList});break;case"productsmanagers":this.setState({filteredProductsManagers:this.state.productsManagersList});break;case"deliveryworkers":this.setState({filteredDeliveryWorkers:this.state.deliveryWorkersList});break}return}switch(t){case"admins":const o=this.state.adminsList.filter(d=>d.name.toLowerCase().includes(a.toLowerCase()));this.setState({filteredAdmins:o});break;case"productsmanagers":const i=this.state.productsManagersList.filter(d=>d.name.toLowerCase().includes(a.toLowerCase()));this.setState({filteredProductsManagers:i});break;case"deliveryworkers":const l=this.state.deliveryWorkersList.filter(d=>d.name.toLowerCase().includes(a.toLowerCase()));this.setState({filteredDeliveryWorkers:l});break}});c(this,"handleRoleOnChange",async(t,a)=>{try{alert(`${t} ${a}`);const o=await v(j(u,"admins")),i=await v(j(u,"productsmanagers")),l=await v(j(u,"deliveryworkers")),d=async(f,x)=>{let k=null;for(let C of f.docs){const E=C.data();if(E.name===t){k={id:C.id,...E,collection:x},await X(C.ref),console.log(`Documento eliminado de la colección ${x}`);const F=m(u,a.toLowerCase(),C.id);await B(F,{name:E.name}),console.log(`Documento añadido a la colección ${a.toLowerCase()}`);break}}return k};let n=await d(o,"admins");n||(n=await d(i,"productsmanagers")),n||(n=await d(l,"deliveryworkers")),console.log(n?`Usuario encontrado: ${n.name}, ID: ${n.id} en la colección ${n.collection}`:"Usuario no encontrado en ninguna colección")}catch(o){console.error("Error buscando o modificando usuario:",o)}});c(this,"handleDeleteProduct",async t=>{try{const a=m(u,"products",t);(await g(a)).exists()?(await X(a),console.log("Producto eliminado exitosamente:",this.state.productName),window.location.href=""):console.log("El producto no existe")}catch(a){console.error("Error al eliminar el producto:",a)}});c(this,"handleCloseSelectedProduct",()=>{this.setState({selectedProduct:!1,sureToDeleteThisProductMessage:!1})});c(this,"getAllStates",async()=>{const t=j(u,"states");try{const o=(await v(t)).docs.map(i=>i.id);this.setState({states:o})}catch(a){console.error("Error al obtener los nombres de los estados:",a)}});c(this,"handleStateSelection",async t=>{const a=m(u,"states",t);try{this.setState({selectedState:t});const o=await g(a);if(o.exists()){const i=o.data(),l=Object.keys(i);this.setState({zones:l,selectedZone:null,municipalities:[]})}else console.error("El documento del estado no existe.")}catch(o){console.error("Error al obtener las zonas del estado seleccionado:",o)}});c(this,"handleTypeChange",t=>{this.setState({productType:t.target.value})});c(this,"handleCategoryChange",t=>{this.setState({productCategory:t.target.value})});c(this,"handleZoneSelection",t=>{const{states:a,selectedState:o}=this.state,i=m(u,"states",o);g(i).then(l=>{if(l.exists()){const n=l.data()[t]||[];this.setState({selectedZone:t,municipalities:n})}else console.error("El documento del estado no existe.")}).catch(l=>{console.error("Error al obtener los municipios de la zona seleccionada:",l)})});c(this,"handleInputRefKeyDown",()=>{event.key==="Enter"&&this.searchIconRef.current.click()});c(this,"handleAddUserBtnClick",async t=>{const{newUser:a,newUserRol:o,newUserName:i,selectedState:l,selectedZone:d}=this.state;if(!a||!o||!i){alert("Por favor, complete todos los campos."),t.preventDefault();return}if(o==="deliveryworkers"&&(!l||!d)){alert("Por favor, seleccione un estado y una zona."),t.preventDefault();return}try{const n=m(j(u,o),a);if((await g(n)).exists()){alert("El usuario ya está registrado en ese rol");return}const x={name:i};o==="deliveryworkers"&&(x.zone=`${l}, ${d}`),await B(n,x),alert("Rol Asignado Correctamente")}catch(n){console.error("Error: ",n),alert("Ocurrió un error inesperado")}});c(this,"handleModifyProductCategory",async t=>{try{const a=m(u,"products",t);(await g(a)).exists()?(await w(a,{category:this.state.productCategory}),console.log("Product category updated successfully."),alert("Categoría modificada correctamente."),window.location.href=""):console.error("No such product!")}catch(a){console.error("Error updating product category:",a),alert("Error al modificar la categoría del producto.")}});c(this,"handleModifyProductComments",async t=>{try{const a=m(u,"products",t);(await g(a)).exists()?(await w(a,{comments:this.state.productComments}),console.log("Product comments updated successfully."),alert("Comentarios modificados correctamente."),window.location.href=""):console.error("No such product!")}catch(a){console.error("Error updating product comments:",a),alert("Error al modificar los comentarios del producto.")}});c(this,"handleCommentsChange",t=>{this.setState({productComments:t.target.value})});this.state={searchPlaceholder:"Introduzca una búsqueda válida",cookiesAccepted:Oe(),showPasswordInputs:!1,showCircle:!1,showCheck:!1,showConfirmInput:!1,showConfirmCircle:!1,showConfirmCheck:!1,showConfirmBtn:!1,showChangePasswordBtn:!0,showChangePasswordMessage:!1,errorMessageChangingPassword:!1,userBtn:!0,logInBtn:!1,uploadValue:0,uploadValue2:0,picture:"../../src/assets/pfp.png",fileUploadButtonText:"Subir",isAdmin:!1,isAdmin2:!1,showAddresses:!1,addresses:!1,addressesShow:[],formData:{street:"",colony:"",postalCode:"",additionalInfo:""},modifyAddressForm:!1,selectedAddress:null,userId:null,addressIndex:null,userInfo:!1,email:null,progress:!1,sales:!1,purchases:[],purchaseHistory:[],selectedPurchaseItems:[],salesList:!1,users:!1,usersList:[],adminActions:null,receiverId:"",subject:"",message:"",message2:"",messageUserForm:!1,userPicture:"../../src/assets/pfp.png",currentUserUID:"",userMessages:!1,messagesShow:[],messageShow:!1,messageSubject:null,messageMessage:null,messajeEmail:null,messageSender:null,unseenMessages:0,messageBackForm:!1,offlineMessage:!navigator.onLine,noMoreAddressesMsg:!1,isDelivery:!1,isProductManager:!1,productImgUrl:"",addProductErrorMessage:!1,addProductDoneMessage:!1,manageProducts:!1,productsLoaded:!1,productName:null,productStock:null,productImageUrl:null,productType:null,productCategory:null,productComments:null,selectedProduct:!1,productSelectedId:null,pictureToRemove:null,productAddedCorrectly:!1,manageRoles:!1,adminsList:[],deliveryWorkersList:[],productsManagersList:[],filteredAdmins:[],filteredProductsManagers:[],filteredDeliveryWorkers:[],deliveryWorkerZone:null,states:[],zones:[],municipalities:[],newUser:null,newUserName:null},this.searchDivRef=p.createRef(),this.rightArrowRef=p.createRef(),this.mobileContentRef=p.createRef(),this.searchIconRef=p.createRef(),this.searchInputRef=p.createRef(),this.newPasswordInputRef=p.createRef(),this.newPasswordInputRef2=p.createRef(),this.currentPasswordRef=p.createRef(),this.fileInputRef=p.createRef(),this.fileUploadButton=p.createRef(),this.pfpRef=p.createRef(),this.typeOfProductRef=p.createRef(),this.productName=p.createRef(),this.productStock=p.createRef(),this.productCategory=p.createRef(),this.productComments=p.createRef(),this.productPrice=p.createRef(),this.productToModifyName=p.createRef(),this.productToModifyStock=p.createRef(),this.newPictureToSet=p.createRef(),this.productToModifyType=p.createRef(),this.verifyPassword=this.verifyPassword.bind(this),this.verifyPassword2=this.verifyPassword2.bind(this)}componentDidMount(){this.getAllStates(),Le().then(t=>{if(t!=="Mexico"){let a=document.body;a.innerHTML="",a.innerHTML="Página no disponible"}}),window.addEventListener("online",this.updateOnlineStatus),window.addEventListener("offline",this.updateOnlineStatus),q(b,t=>{if(t){this.setState({currentUserUID:t.uid,userId:t.uid,email:t.email}),this.fetchAddresses(),this.fetchMessages(),this.fetchAllUsers();const a=D(R,`pictures/${t.uid}`);L(a).then(n=>{this.setState({picture:n})}).catch(n=>{console.log("Error al descargar la imagen: ",n)});const o=m(u,"admins",t.uid);g(o).then(n=>{n.exists()&&(this.setState({isAdmin:!0}),this.fetchPendingPurchases())}).catch(n=>{console.log("Error al verificar admin:",n)});const i=m(u,"admins2",t.uid);g(i).then(n=>{n.exists()&&(this.setState({isAdmin2:!0}),this.fetchPendingPurchases())}).catch(n=>{console.log("Error al verificar admin:",n)});const l=m(u,"deliveryworkers",t.uid);g(l).then(n=>{n.exists()&&this.setState({isDelivery:!0},async()=>{this.setState({deliveryWorkerZone:await this.getDeliveryWorkerZone(l)},()=>{this.handleLoadAllPendingPurchases()})})}).catch(n=>{console.log("Error al verificar repartidor:",n)});const d=m(u,"productsmanagers",t.uid);g(d).then(n=>{n.exists()&&this.setState({isProductManager:!0})}).catch(n=>{console.log("Error al verificar repartidor:",n)})}else this.setState({userBtn:!1,logInBtn:!0})})}componentWillUnmount(){window.addEventListener("click",i=>{i.target.parentNode.classList.contains("admin-tools")&&this.schroll()}),window.removeEventListener("online",this.updateOnlineStatus),window.removeEventListener("offline",this.updateOnlineStatus);const{rightArrowRef:t,searchIconRef:a,searchInputRef:o}=this;t.current.removeEventListener("click",this.handleRightArrowClick),a.current.removeEventListener("click",this.handleSearchIconClick),o.current.removeEventListener("keypress",this.handleSearchInputKeyPress)}async fetchUsers(){try{const o=(await Fe.get("http://localhost:5000/api/users")).data.filter(i=>i.uid!==this.state.currentUserUID);this.setState({usersList:o,loading:!1})}catch(t){alert(t.message)}}async fetchAddresses(){const t=b.currentUser;try{if(!t){console.log("No user logged in."),this.setState({addressesShow:[]});return}const a=m(u,"addresses",t.uid),o=await g(a);if(o.exists()){const l=o.data().addresses||[];this.setState({addressesShow:l})}else this.setState({addressesShow:[]})}catch(a){console.error("Error fetching addresses:",a)}}verifyPassword(){this.newPasswordInputRef.current.value.length>5?this.setState({showCircle:!1,showCheck:!0,showConfirmInput:!0}):this.setState({showCircle:!0,showCheck:!1,showConfirmInput:!1})}verifyPassword2(){const t=this.newPasswordInputRef.current;this.newPasswordInputRef2.current.value===t.value?this.setState({showConfirmCheck:!0,showConfirmBtn:!0}):this.setState({showConfirmCheck:!1,showConfirmBtn:!1})}async fetchMessages(){const t=b.currentUser;let a=0;try{const o=T(j(u,"messages"),N("receiverId","==",t.uid)),l=(await v(o)).docs.map(d=>{const n=d.data();return n.read=="false"&&a++,{id:d.id,...n}});this.setState({messagesShow:l,unseenMessages:a})}catch(o){console.error("Error fetching messages:",o)}}async fetchAllUsers(){try{const t=await v(j(u,"admins")),a=await v(j(u,"productsmanagers")),o=await v(j(u,"deliveryworkers")),i=[],l=[],d=[];t.forEach(n=>{i.push({id:n.id,role:"Administrador de Ventas",...n.data()})}),a.forEach(n=>{l.push({id:n.id,role:"Administrador de Productos",...n.data()})}),o.forEach(n=>{d.push({id:n.id,role:"Repartidor",...n.data()})}),this.setState({adminsList:i,productsManagersList:l,deliveryWorkersList:d})}catch(t){console.error("Error fetching users: ",t)}}render(){const{cookiesAccepted:t,showPasswordInputs:a,showCircle:o,showCheck:i,showConfirmInput:l,showConfirmCheck:d,showConfirmBtn:n,showChangePasswordBtn:f,showConfirmCircle:x,showChangePasswordMessage:k,errorMessageChangingPassword:C,userBtn:E,logInBtn:F,fileUploadButtonText:ee,isAdmin:I,showAddresses:se,addressesShow:te,modifyAddressForm:ae,selectedAddress:M,userId:re,userInfo:oe,progress:z,sales:ie,purchases:ne,purchaseHistory:ce,selectedPurchaseItems:U,selectedPurchaseAddress:P,salesList:le,users:de,adminActions:he,messageUserForm:ue,receiverId:W,subject:V,message:H,userMessages:me,messagesShow:Q,messageShow:pe,messageBackForm:fe,currentUserUID:ge,unseenMessages:Z,offlineMessage:xe,noMoreAddressesMsg:je,isDelivery:ye,isProductManager:K,addProduct:Ce,addProductErrorMessage:ve,addProductDoneMessage:Se,manageProducts:we,selectedProduct:ke,productAddedCorrectly:Ne,isAdmin2:O,manageRoles:Pe,adminsList:_e,deliveryWorkersList:Ye,productsManagersList:Xe,filteredAdmins:Je,sureToDeleteThisProductMessage:Ie}=this.state,be=ne.reduce((r,h)=>(r[h.userId]||(r[h.userId]=[]),r[h.userId].push(h),r),{}),{usersList:Ae}=this.state;return s.jsxs(s.Fragment,{children:[xe&&s.jsx("div",{className:"offline-message",children:s.jsx("p",{children:"Sin conexión a internet"})}),s.jsxs("section",{className:"top",children:[s.jsx("i",{className:"fa-solid fa-chevron-right",ref:this.rightArrowRef,onClick:this.handleRightArrowClick}),s.jsx("div",{className:"mobile-content",ref:this.mobileContentRef,children:(!I||!O)&&s.jsxs(s.Fragment,{children:[s.jsx("a",{href:"products/index.html",children:"PRODUCTOS"}),s.jsx("a",{href:"about-us/index.html",children:"ACERCA DE"}),s.jsx("a",{href:"contact-us/index.html",children:"CONTACTO"})]})}),s.jsx("a",{href:"",className:"reload-page",children:s.jsx("img",{src:"../../src/assets/brand.png",className:"brand",alt:"brand"})}),s.jsx("div",{className:"top-sections",children:(!I||!I)&&s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>this.navigateTo("products/index.html"),className:"products btns",children:"PRODUCTOS"}),s.jsx("button",{onClick:()=>this.navigateTo("about-us/index.html"),className:"about-us btns",children:"ACERCA DE"}),s.jsx("button",{onClick:()=>this.navigateTo("contact-us/index.html"),className:"contact-us btns",children:"CONTACTO"})]})}),s.jsxs("div",{className:"look-up",children:[E&&s.jsx("button",{className:"user",name:"user",onClick:()=>this.handleAppearUserInfo(),children:s.jsx("img",{src:"../../src/assets/pfp.png",alt:"",width:32})}),F&&s.jsx("button",{className:"log-btn",onClick:()=>this.navigateTo("../"),children:"Iniciar Sesión"}),s.jsxs("div",{className:"search-div",ref:this.searchDivRef,children:[ge&&s.jsxs(s.Fragment,{children:[s.jsx("i",{className:"fa-regular fa-envelope",onClick:this.handleShowMessages}),Z!==0&&s.jsx("a",{className:"unseen-messages",children:Z})]}),s.jsx("i",{className:"fa-solid fa-magnifying-glass top-search",onClick:this.searchAppear})]})]})]}),!t&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"cookies-advice activo",id:"cookies-advice",children:[s.jsx("img",{className:"cookie",src:"../../src/assets/cookie.svg",alt:"Cookie"}),s.jsx("h3",{className:"tittle",children:"Cookies"}),s.jsx("p",{className:"paragraph",children:"Utilizamos cookies propias y de terceros para mejorar nuestros servicios."}),s.jsx("button",{className:"button",id:"accept-cookies-btn",onClick:this.handleAcceptCookies,children:"De acuerdo"}),s.jsx("a",{className:"link",href:"abendet-cookies/index.html",children:"Aviso de Cookies"})]}),s.jsx("div",{className:"back-cookies-advice activo",id:"back-cookies-advice"})]}),s.jsxs("footer",{className:"footer",children:[s.jsxs("div",{className:"footer-div1",children:[s.jsx("a",{href:"products/index.html",children:"Productos"}),s.jsx("a",{href:"about-us/index.html",children:"Acerca De"}),s.jsx("a",{href:"contact-us/index.html",children:"Contacto"})]}),s.jsxs("div",{className:"footer-div2",children:[s.jsx("a",{href:"sponsorships/index.html",children:"Patrocinios"}),s.jsx("a",{href:"abendet-cookies/index.html",children:"Cookies"}),s.jsx("a",{href:"abendet-privacy/index.html",children:"Privacidad"})]})]}),s.jsxs("section",{className:"search",ref:this.searchDivRef,children:[s.jsx("h1",{children:"Estamos contentos de ayudarte"}),s.jsx("input",{className:"search-input",ref:this.searchInputRef,onKeyDown:this.handleInputRefKeyDown}),s.jsx("i",{className:"fa-solid fa-magnifying-glass search-icon",ref:this.searchIconRef,onClick:this.handleSearchIconClick})]}),oe&&s.jsxs("div",{className:"user-info",children:[s.jsx("i",{className:"fa-solid fa-xmark close",onClick:()=>this.setState({userInfo:!1,showPasswordInputs:!1,showChangePasswordBtn:!0})}),s.jsx("br",{}),s.jsx("p",{children:"Foto de perfil: "}),s.jsx("img",{src:this.state.picture,alt:"",width:100,className:"pfp-img"}),s.jsx("br",{}),s.jsxs("div",{className:"file-upload-wrapper",children:[s.jsx("button",{className:"file-upload-button",ref:this.fileUploadButton,onClick:()=>this.fileInputRef.current.click(),children:ee}),s.jsx("input",{type:"file",id:"fileInput",ref:this.fileInputRef,onChange:this.handleOnChange,style:{display:"none"}})]}),z&&s.jsx("p",{children:s.jsx("progress",{value:this.state.uploadValue,max:100,className:"progress"})}),s.jsxs("div",{className:"email",children:["Email: ",this.state.email]}),s.jsx("br",{}),f&&s.jsxs("button",{className:"change-password",onClick:()=>this.setState({showPasswordInputs:!0,showChangePasswordBtn:!1}),ref:this.changePasswordBtnRef,children:["Cambiar Contraseña",s.jsx("i",{className:"fa-duotone fa-solid fa-pen-to-square"})]}),s.jsx("br",{}),s.jsx("br",{}),s.jsx("br",{}),k&&s.jsx("div",{className:"password-successfully-changed",children:"Contraseña cambiada correctamente"}),C&&s.jsx("div",{className:"error-changing-password",children:"Error al cambiar la contraseña"}),a&&s.jsxs("div",{children:[s.jsx("input",{type:"password",placeholder:"Contraseña actual",ref:this.currentPasswordRef}),s.jsx("br",{}),s.jsx("br",{}),s.jsx("input",{type:"password",placeholder:"Nueva contraseña",ref:this.newPasswordInputRef,onKeyUp:this.verifyPassword}),o&&s.jsx("i",{className:"fa-solid fa-circle"}),i&&s.jsx("i",{className:"fa-solid fa-check"}),s.jsx("br",{}),s.jsx("br",{}),l&&s.jsx("input",{type:"password",placeholder:"Confirmar nueva contraseña",ref:this.newPasswordInputRef2,onKeyUp:this.verifyPassword2}),x&&s.jsx("i",{className:"fa-solid fa-circle"}),d&&s.jsx("i",{className:"fa-solid fa-check"}),n&&s.jsx("button",{className:"confirm-change-password-btn",onClick:this.handlePasswordChangeClick,children:"Cambiar Contraseña"})]}),(!I||O)&&s.jsxs("button",{className:"manage-addresses-btn",onClick:()=>this.setState({showAddresses:!0}),children:["Administrar Direcciones ",s.jsx("i",{className:"fa-duotone fa-solid fa-pen-to-square"})]}),s.jsx("button",{className:"log-out",onClick:this.logOut,children:"Cerrar Sesión"})]}),se&&s.jsxs("div",{className:"addresses",children:[s.jsx("i",{className:"fa-solid fa-xmark close",onClick:()=>this.setState({showAddresses:!1})}),"Direcciones guardadas",te.map((r,h)=>s.jsxs("li",{style:{position:"relative"},children:[s.jsx("i",{className:"fa-duotone fa-solid fa-pen-to-square modify-address ad-i",onClick:()=>this.handleModifyAddress(r,h)}),s.jsx("i",{className:"fa-solid fa-trash delete-address ad-i",onClick:()=>this.handleDeleteAddress(r,h)}),s.jsxs("p",{children:["Calle: ",r.street]}),s.jsxs("p",{children:["Colonia: ",r.colony]}),s.jsxs("p",{children:["Código Postal: ",r.postalCode]}),s.jsxs("p",{children:["Información adicional: ",r.additionalInfo]})]},h)),s.jsxs("button",{className:"add-address-btn",onClick:this.handleAddAddressBtnFromUserInfo,children:["Añadir dirección",s.jsx("i",{className:"fa-solid fa-up-right-from-square"})]})]}),ae&&s.jsxs("div",{className:"modify-address-div",children:[s.jsx("i",{className:"fa-solid fa-xmark close",onClick:this.handleCloseModifyAddressForm}),s.jsx("h2",{children:"Modificar Dirección"}),"Calle: ",s.jsx("input",{defaultValue:M.street,onChange:r=>this.handleInputChange("street",r.target.value)}),"Colonia: ",s.jsx("input",{defaultValue:M.colony,onChange:r=>this.handleInputChange("colony",r.target.value)}),"Código Postal: ",s.jsx("input",{defaultValue:M.postalCode,onChange:r=>this.handleInputChange("postalCode",r.target.value)}),"Información adicional: ",s.jsx("input",{defaultValue:M.additionalInfo,onChange:r=>this.handleInputChange("additionalInfo",r.target.value)}),s.jsx("i",{className:"fa-solid fa-check modify-address-save-btn",onClick:()=>this.handleModifyAddressOnDB(M,re)})]}),(I||K||O)&&s.jsxs("div",{className:"admin-tools",children:[O&&s.jsx(s.Fragment,{children:s.jsx("button",{onClick:()=>this.setState({manageRoles:!0}),children:"Administrar Roles"})}),I&&s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>this.setState({sales:!0,userInfo:!1}),children:"Administrar Ventas"}),s.jsx("button",{onClick:this.handleUsersListClick,children:"Usuarios"})]}),K&&s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:this.handleManageProductsBtnClick,children:"Administrar Productos"}),s.jsx("button",{onClick:()=>this.setState({addProduct:!0}),children:"Añadir Producto"})]})]}),ye&&s.jsxs("div",{className:"delivery-page",children:[s.jsx("i",{className:"fa-solid fa-xmark close",onClick:()=>this.setState({isDelivery:!1})}),s.jsx("h2",{children:"Envíos pendientes"}),this.state.isLoading?s.jsx("p",{children:"Cargando..."}):this.state.purchaseHistory&&this.state.purchaseHistory.length>0?s.jsx("ul",{children:this.state.purchaseHistory.filter(r=>{const h=r.deliveryDate&&r.deliveryDate!=="pendiente";return console.log(`ID: ${r.id}, deliveryDate: ${r.deliveryDate}, isValidDate: ${h}`),h}).map(r=>s.jsxs(p.Fragment,{children:[s.jsx("li",{children:s.jsxs("button",{onClick:()=>this.handleLoadPurchase(r.id,r.inTheWay),className:"list-purchase-date",children:["Compra del ",new Date(r.timestamp).toLocaleString()]})}),s.jsx("li",{children:s.jsxs("label",{children:["Estado de la compra:",s.jsxs("select",{onChange:h=>this.updatePurchaseStatus(r.id,h.target.value),value:r.inTheWay==="yes"?"En envío":r.delivered==="yes"?"Entregado":"",children:[s.jsx("option",{value:"",disabled:!0,children:"Seleccionar estado"}),s.jsx("option",{value:"En envío",children:"En envío"}),s.jsx("option",{value:"Entregado",children:"Entregado"})]})]})})]},r.id))}):s.jsx("p",{children:"No hay envíos pendientes."})]}),ie&&s.jsxs("div",{className:"sales",children:[s.jsx("i",{className:"fa-solid fa-xmark close",onClick:()=>this.setState({sales:!1})}),s.jsx("h2",{children:"Ventas"}),le&&s.jsxs("ul",{className:"sales-list",children:[s.jsx("i",{className:"fa-solid fa-xmark close",onClick:()=>this.setState({salesList:!1})}),ce.map(r=>s.jsxs(p.Fragment,{children:[s.jsx("li",{children:s.jsxs("button",{onClick:()=>this.handleLoadPurchase(r.id),children:["Compra del ",new Date(r.timestamp).toLocaleString(),r.canceled==="yes"&&s.jsx("span",{style:{color:"#c12"},children:" (Cancelada)"})]})}),r.canceled==="no"&&s.jsx("li",{children:s.jsxs("label",{children:["Asignar Fecha de Entrega:",s.jsx("input",{type:"date",onChange:h=>{const De=h.target.value,$=new Date(De),G=new Date($);G.setDate($.getDate()+7);const Re=$.toISOString().split("T")[0],Ee=G.toISOString().split("T")[0];this.assignDeliveryDate(r.id,`${Re} al ${Ee}`)}})]})})]},r.id)),s.jsx("button",{onClick:()=>this.setState({salesList:!1}),className:"sales-list-done-btn",children:"Listo"})]}),s.jsx("button",{className:"filter",onClick:this.handleFilter,children:"Filtrar"}),Object.keys(be).map(r=>s.jsx("li",{children:s.jsxs("button",{onClick:()=>this.handleUserClick(r),className:"buyer",children:["Comprador: ",r," ",s.jsx("i",{className:"fa-solid fa-up-right-from-square"})]})},r))]}),U.length>0&&s.jsxs("div",{className:"selected-purchase",children:[s.jsx("i",{className:"fa-solid fa-xmark close",onClick:()=>this.setState({selectedPurchaseItems:!1})}),s.jsx("h2",{children:"Detalles de la Compra Seleccionada"}),"Comprador: ",this.state.payerName,s.jsx("ul",{children:U.map((r,h)=>s.jsx("li",{children:s.jsx("div",{children:s.jsxs("p",{children:[r.name," x",r.amount," = $",r.totalPrice.toFixed(2)]})})},h))}),s.jsxs("div",{className:"selected-purchase-address",children:[s.jsx("h3",{children:"Dirección de Envío:"}),s.jsxs("p",{children:["Calle: ",P.street]}),s.jsxs("p",{children:["Colonia: ",P.colony]}),s.jsxs("p",{children:["Código Postal: ",P.postalCode]}),s.jsxs("p",{children:["Información adicional: ",P.additionalInfo]})]}),s.jsxs("p",{className:"delivery-date",children:["Fecha de entrega:"," ",s.jsx("a",{children:this.state.deliveryDate==="pendiente"?"Pendiente":`del ${this.formatDate(this.state.deliveryDate.split(" al ")[0])} al ${this.formatDate(this.state.deliveryDate.split(" al ")[1])}`})]}),s.jsx("button",{onClick:()=>this.setState({selectedPurchaseItems:[]}),children:"Cerrar Detalles"})]}),de&&s.jsxs("div",{className:"users",children:[s.jsx("i",{className:"fa-solid fa-xmark close",onClick:()=>this.setState({users:!1,adminActions:!1})}),s.jsx("h2",{children:"Usuarios"}),s.jsx("input",{type:"text",placeholder:"Buscar",className:"user-search",onKeyUp:this.userSearch}),s.jsx("div",{children:s.jsx("ul",{children:Ae.map(r=>s.jsxs("li",{children:[s.jsxs("p",{className:"uid",children:[s.jsx("strong",{children:"UID:"})," ",r.uid]})," ",s.jsxs("p",{className:"email",children:[s.jsx("strong",{children:" Email:"})," ",r.email||"N/A",s.jsx("i",{className:"fa-solid fa-ellipsis-vertical",onClick:()=>this.handleAdminActionsClick(r.uid)})]}),he===r.uid&&s.jsx("ul",{className:"admin-actions",children:s.jsx("li",{onClick:()=>this.handleMessageUser(r.uid),children:"Mensaje"})}),s.jsx("hr",{})]},r.uid))})})]}),ue&&s.jsxs("form",{onSubmit:this.sendMessage,className:"send-message-form",children:[s.jsx("i",{className:"fa-solid fa-xmark close",onClick:()=>this.setState({messageUserForm:!1})}),s.jsx("img",{src:this.state.userPicture,width:100}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"receiverId",children:"ID del Usuario:"}),s.jsx("input",{type:"text",id:"receiverId",name:"receiverId",value:W,onChange:this.handleInputChange2,required:!0,readOnly:!!W})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"subject",children:"Asunto:"}),s.jsx("input",{type:"text",id:"subject",name:"subject",value:V,onChange:this.handleInputChange2,required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"message",children:"Mensaje:"}),s.jsx("textarea",{id:"message",name:"message",value:H,onChange:this.handleInputChange2,required:!0})]}),s.jsx("button",{type:"submit",children:"Enviar Mensaje"})]}),fe&&s.jsxs("form",{onSubmit:this.sendMessageBack,className:"send-message-form",children:[s.jsx("i",{className:"fa-solid fa-xmark close",onClick:()=>this.setState({messageBackForm:!1})}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"senderId",children:"ID del Usuario:"}),s.jsx("input",{type:"text",id:"senderId",name:"senderId",value:this.state.messageSender,onChange:this.handleInputChange2,required:!0,readOnly:!0})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"subject",children:"Asunto:"}),s.jsx("input",{type:"text",id:"subject",name:"subject",value:V,onChange:this.handleInputChange2,required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"message",children:"Mensaje:"}),s.jsx("textarea",{id:"message",name:"message",value:H,onChange:this.handleInputChange2,required:!0})]}),s.jsx("button",{type:"submit",children:"Enviar Mensaje"})]}),me&&s.jsxs("div",{className:"messages",children:[s.jsx("i",{className:"fa-solid fa-xmark close",onClick:this.handleCloseMessagesWindow}),s.jsx("h2",{children:"Mensajes Recibidos"}),s.jsxs("ul",{children:[Q.map((r,h)=>s.jsx("li",{style:{position:"relative"},onClick:()=>this.handleMessageClick(r.id),children:s.jsxs("p",{children:[r.subject,r.read=="false"&&s.jsx("i",{className:"fa-solid fa-bell"}),s.jsx("i",{className:"fa-solid fa-reply see-message"})]})},h)),Q.length<1&&s.jsx("p",{className:"no-messages",children:"No hay mensajes"})]})]}),pe&&s.jsxs("div",{className:"message-div",children:[s.jsx("i",{className:"fa-solid fa-xmark close",onClick:this.handleCloseMessageClick}),s.jsx("h2",{children:"Mensaje recibido por administrador"}),I&&s.jsxs("p",{children:["Email: ",this.state.messageEmail]}),s.jsx("p",{className:"subject",children:this.state.messageSubject}),s.jsx("p",{className:"message",children:this.state.messageMessage}),s.jsxs("p",{className:"reply",onClick:()=>this.handleReplay(this.state.messageSender),children:["Responder",s.jsx("i",{className:"fa-solid fa-reply"})]})]}),je&&s.jsx("p",{className:"error-messages",children:"No puede añadir más de 3 direcciones"}),Ce&&s.jsxs("div",{className:"add-product-div",children:[s.jsx("i",{className:"fa-solid fa-xmark close",onClick:()=>this.setState({addProduct:!1})}),s.jsx("h2",{children:"Añadir Producto"}),s.jsx("input",{type:"text",placeholder:"Nombre",ref:this.productName}),s.jsx("input",{type:"number",placeholder:"Stock",ref:this.productStock}),s.jsx("input",{type:"number",placeholder:"Precio",ref:this.productPrice}),s.jsx("input",{type:"file",placeholder:"Imágen",onChange:this.handleOnChangeOnProductImg}),z&&s.jsx("p",{children:s.jsx("progress",{value:this.state.uploadValue2,max:100,className:"progress"})}),s.jsx("p",{children:this.state.message2}),s.jsxs("select",{placeholder:"Tipo",ref:this.typeOfProductRef,children:[s.jsx("option",{value:"",children:"Selecciona Tipo"}),s.jsx("option",{value:"shampoo",children:"Shampoo"}),s.jsx("option",{value:"acondicionador",children:"Acondicionador"})]}),s.jsxs("select",{placeholder:"Categoría Objetivo",ref:this.productCategory,children:[s.jsx("option",{value:"",children:"Selecciona Categoría"}),s.jsx("option",{value:"caspa",children:"Caspa"}),s.jsx("option",{value:"brillo",children:"Brillo"}),s.jsx("option",{value:"alisamiento",children:"Alisamiento"}),s.jsx("option",{value:"revitalización",children:"Revitalización"}),s.jsx("option",{value:"hidratación",children:"Hidratación"})]}),s.jsx("input",{type:"text",placeholder:"Comentarios",ref:this.productComments}),ve&&s.jsx("p",{className:"add-product-error-message-p",children:"Por favor, complete todos los campos"}),Se&&s.jsx("p",{className:"add-product-done-message-p",children:"Producto guardado exitosamente"}),s.jsx("button",{onClick:this.handleSaveProduct,children:"Guardar"})]}),we&&s.jsxs("div",{className:"manage-products-div",children:[s.jsx("i",{className:"fa-solid fa-xmark close",onClick:()=>this.setState({manageProducts:!1})}),s.jsx("h2",{children:"Administrar productos"}),this.state.products&&this.state.products.length>0?s.jsx("ul",{children:this.state.products.map((r,h)=>s.jsx("li",{children:s.jsx("button",{onClick:()=>this.handleProductClick(r.productId,r.imageUrl),children:r.name})},h))}):s.jsx("p",{className:"no-purchases",children:"No hay compras"})]}),U.length>0&&s.jsxs("div",{className:"selected-purchase",children:[s.jsx("h2",{children:"Detalles de la Compra Seleccionada"}),"Comprador: ",this.state.payerName,s.jsx("ul",{children:U.map((r,h)=>s.jsx("li",{children:s.jsx("div",{children:s.jsxs("p",{children:[r.name," x",r.amount," = $",r.totalPrice.toFixed(2)]})})},h))}),s.jsxs("div",{className:"selected-purchase-address",children:[s.jsx("h3",{children:"Dirección de Envío:"}),s.jsxs("p",{children:["Calle: ",P.street]}),s.jsxs("p",{children:["Colonia: ",P.colony]}),s.jsxs("p",{children:["Código Postal: ",P.postalCode]}),s.jsxs("p",{children:["Información adicional: ",P.additionalInfo]})]}),s.jsxs("p",{className:"delivery-date",children:["Fecha de entrega:"," ",s.jsx("a",{children:this.state.deliveryDate==="pendiente"?"Pendiente":`del ${this.formatDate(this.state.deliveryDate.split(" al ")[0])} al ${this.formatDate(this.state.deliveryDate.split(" al ")[1])}`})]}),s.jsx("div",{children:this.state.purchaseCanceled==="no"&&this.state.inTheWay==="no"&&this.state.delivered==="no"&&s.jsxs("div",{children:[s.jsxs("a",{className:"generate-ticket",onClick:this.donwloadTicket,children:["Generar ticket ",s.jsx("i",{className:"fa-solid fa-ticket"})]}),s.jsx("button",{className:"cancel-purchase-btn",onClick:this.handleCancelPurchaseBtnClick,children:"CANCELAR COMPRA"})]})}),s.jsx("div",{children:this.state.purchaseCanceled==="yes"&&s.jsx("p",{className:"canceled-purchase",children:"COMPRA CANCELADA"})}),s.jsx("div",{children:this.state.delivered==="yes"&&s.jsx("p",{className:"purchase-delivered",children:"ENTREGADO"})}),s.jsx("button",{onClick:()=>this.setState({selectedPurchaseItems:[]}),className:"close-details",children:"Cerrar Detalles"})]}),ke&&s.jsxs("div",{className:"selected-product-div",children:[s.jsx("i",{className:"fa-solid fa-xmark close",onClick:this.handleCloseSelectedProduct}),s.jsx("h2",{children:"Detalles del Producto Seleccionado"}),s.jsxs("p",{className:"product-name",children:["Nombre: ",this.state.productName,s.jsx("i",{className:"fa-duotone fa-solid fa-pen-to-square modify-product-icon",onClick:()=>this.setState({modifyProductNameInput:!0})})]}),this.state.modifyProductNameInput&&s.jsxs("div",{className:"modify-product-property-div",children:[s.jsx("i",{className:"fa-solid fa-xmark close",onClick:()=>this.setState({modifyProductNameInput:!1})}),s.jsx("h2",{children:"Modificar Nombre"}),s.jsx("input",{type:"text",defaultValue:this.state.productName,onChange:this.handleNameChange,ref:this.productToModifyName}),s.jsx("button",{className:"modify-product-property-cancel-btn",onClick:()=>this.setState({modifyProductNameInput:!1}),children:"CANCELAR"}),s.jsx("button",{className:"modify-product-property-ok-btn",onClick:()=>this.handleModifyProductName(this.state.productSelectedId),children:"ACEPTAR"})]}),s.jsxs("p",{className:"product-stock",children:["Stock: ",this.state.productStock,s.jsx("i",{className:"fa-duotone fa-solid fa-pen-to-square modify-product-icon",onClick:()=>this.setState({modifyProductStockInput:!0})})]}),this.state.modifyProductStockInput&&s.jsxs("div",{className:"modify-product-property-div",children:[s.jsx("i",{className:"fa-solid fa-xmark close",onClick:()=>this.setState({modifyProductStockInput:!1})}),s.jsx("h2",{children:"Modificar Stock"}),s.jsx("input",{type:"number",defaultValue:this.state.productStock,onChange:this.handleStockChange,ref:this.productToModifyStock}),s.jsx("button",{className:"modify-product-property-cancel-btn",children:"CANCELAR"}),s.jsx("button",{className:"modify-product-property-ok-btn",onClick:()=>this.handleModifyProductStock(this.state.productSelectedId),children:"ACEPTAR"})]}),s.jsx("p",{className:"product-image-label",children:"Imágen:"}),s.jsx("img",{className:"product-img",src:this.state.productImageUrl,alt:this.state.productName}),s.jsx("i",{className:"fa-duotone fa-solid fa-pen-to-square modify-product-icon",onClick:()=>this.setState({modifyProductImageInput:!0})}),this.state.modifyProductImageInput&&s.jsxs("div",{className:"modify-product-property-div",children:[s.jsx("i",{className:"fa-solid fa-xmark close",onClick:()=>this.setState({modifyProductImageInput:!1})}),s.jsx("h2",{children:"Modificar Imágen"}),s.jsx("input",{type:"file",ref:this.newPictureToSet,accept:"image/*"}),s.jsx("button",{className:"modify-product-property-cancel-btn",onClick:()=>this.setState({modifyProductImageInput:!1}),children:"CANCELAR"}),s.jsx("button",{className:"modify-product-property-ok-btn",onClick:()=>{const r=this.newPictureToSet.current.files[0];r?this.handleModifyProductImage(this.state.productSelectedId,this.state.pictureToRemove,r):alert("Por favor, selecciona una imagen.")},children:"ACEPTAR"})]}),s.jsxs("p",{className:"product-type",children:["Tipo: ",this.state.productType,s.jsx("i",{className:"fa-duotone fa-solid fa-pen-to-square modify-product-icon",onClick:()=>this.setState({modifyProductTypeInput:!0})})]}),this.state.modifyProductTypeInput&&s.jsxs("div",{className:"modify-product-property-div",children:[s.jsx("i",{className:"fa-solid fa-xmark close",onClick:()=>this.setState({modifyProductTypeInput:!1})}),s.jsx("h2",{children:"Modificar Tipo"}),s.jsx("input",{type:"text",defaultValue:this.state.productType,ref:this.productToModifyType,onChange:this.handleTypeChange}),s.jsx("button",{className:"modify-product-property-cancel-btn",onClick:()=>this.setState({modifyProductTypeInput:!1}),children:"CANCELAR"}),s.jsx("button",{className:"modify-product-property-ok-btn",onClick:()=>this.handleModifyProductType(this.state.productSelectedId),children:"ACEPTAR"})]}),s.jsxs("p",{className:"product-category",children:["Categoría: ",this.state.productCategory,s.jsx("i",{className:"fa-duotone fa-solid fa-pen-to-square modify-product-icon",onClick:()=>this.setState({modifyProductCategoryInput:!0})})]}),this.state.modifyProductCategoryInput&&s.jsxs("div",{className:"modify-product-property-div",children:[s.jsx("i",{className:"fa-solid fa-xmark close",onClick:()=>this.setState({modifyProductCategoryInput:!1})}),s.jsx("h2",{children:"Modificar Categoría"}),s.jsxs("select",{value:this.state.productCategory,onChange:this.handleCategoryChange,ref:this.productCategory,children:[s.jsx("option",{value:"",children:"Selecciona Categoría"}),s.jsx("option",{value:"caspa",children:"Caspa"}),s.jsx("option",{value:"brillo",children:"Brillo"}),s.jsx("option",{value:"alisamiento",children:"Alisamiento"}),s.jsx("option",{value:"revitalización",children:"Revitalización"}),s.jsx("option",{value:"hidratación",children:"Hidratación"})]}),s.jsx("button",{className:"modify-product-property-cancel-btn",onClick:()=>this.setState({modifyProductCategoryInput:!1}),children:"CANCELAR"}),s.jsx("button",{className:"modify-product-property-ok-btn",onClick:()=>this.handleModifyProductCategory(this.state.productSelectedId),children:"ACEPTAR"})]}),s.jsxs("p",{className:"product-comments",children:["Comentarios: ",this.state.productComments,s.jsx("i",{className:"fa-duotone fa-solid fa-pen-to-square modify-product-icon",onClick:()=>this.setState({modifyProductCommentsInput:!0})})]}),this.state.modifyProductCommentsInput&&s.jsxs("div",{className:"modify-product-property-div",children:[s.jsx("i",{className:"fa-solid fa-xmark close",onClick:()=>this.setState({modifyProductCommentsInput:!1})}),s.jsx("h2",{children:"Modificar Comentarios"}),s.jsx("textarea",{value:this.state.productComments,onChange:this.handleCommentsChange}),s.jsx("button",{className:"modify-product-property-cancel-btn",onClick:()=>this.setState({modifyProductCommentsInput:!1}),children:"CANCELAR"}),s.jsx("button",{className:"modify-product-property-ok-btn",onClick:()=>this.handleModifyProductComments(this.state.productSelectedId),children:"ACEPTAR"})]}),s.jsx("button",{className:"delete-product-btn",onClick:()=>this.setState({sureToDeleteThisProductMessage:!0}),children:"Eliminar Producto"})]}),Ne&&s.jsxs("div",{className:"product-added-correctly-div",children:[s.jsx("p",{children:"Producto Añadido Correctamente"}),s.jsx("button",{onClick:()=>this.setState({productAddedCorrectly:!1}),children:"Aceptar"})]}),Pe&&s.jsxs("div",{className:"manage-roles-div",children:[s.jsx("i",{className:"fa-solid fa-xmark close",onClick:()=>this.setState({manageRoles:!1})}),s.jsx("h2",{children:"Administración de Roles"}),s.jsx("h3",{children:"Añadir Usuario"}),s.jsx("input",{placeholder:"Nombre",onChange:r=>this.setState({newUserName:r.target.value})}),s.jsx("input",{placeholder:"UID del usuario",onChange:r=>this.setState({newUser:r.target.value})}),s.jsx("h3",{children:"Rol del Usuario"}),s.jsxs("select",{onChange:r=>this.setState({newUserRol:r.target.value}),children:[s.jsx("option",{value:"default"}),s.jsx("option",{value:"admins",children:"Administrador de Ventas"}),s.jsx("option",{value:"deliveryworkers",children:"Repartidor"}),s.jsx("option",{value:"productsmanagers",children:"Administrador de Productos"})]}),this.state.newUserRol==="deliveryworkers"&&s.jsxs(s.Fragment,{children:[s.jsx("select",{onChange:r=>this.handleStateSelection(r.target.value),children:this.state.states.map(r=>s.jsx("option",{value:r,children:r},r))}),s.jsxs("select",{onChange:()=>this.setState({selectedZone:event.target.value}),children:[s.jsx("option",{value:"",children:"Selecciona una zona"}),this.state.zones.map(r=>s.jsx("option",{value:r,children:r},r))]})]}),s.jsx("button",{onClick:this.handleAddUserBtnClick,children:"Añadir"}),s.jsx("h3",{children:"Admins"}),s.jsx("input",{placeholder:"Buscar",type:"text",onChange:r=>this.handleSearchOnChangeOnRoles("admins",r.target.value)}),s.jsx("ul",{children:this.state.filteredAdmins.length>0?this.state.filteredAdmins.map(r=>s.jsxs("li",{style:{position:"relative"},children:[s.jsx("p",{children:"UID:"})," ",r.uid," ",s.jsx("p",{children:"Nombre:"})," ",r.name,s.jsxs("select",{defaultValue:r.role||"default",onChange:h=>this.handleRoleOnChange(r.name,h.target.value),children:[s.jsx("option",{value:"default",children:r.role}),s.jsx("option",{value:"admins",children:"Administrador de Ventas"}),s.jsx("option",{value:"productsmanagers",children:"Administrador de Productos"}),s.jsx("option",{value:"deliveryworkers",children:"Repartidor"})]})]},r.uid)):s.jsx("p",{children:"No se encontraron resultados"})}),s.jsx("h3",{children:"Products Managers"}),s.jsx("input",{placeholder:"Buscar",type:"text",onChange:r=>this.handleSearchOnChangeOnRoles("productsmanagers",r.target.value)}),s.jsx("ul",{children:this.state.filteredProductsManagers.length>0?this.state.filteredProductsManagers.map(r=>s.jsxs("li",{style:{position:"relative"},children:[s.jsx("p",{children:"UID:"})," ",r.uid," ",s.jsx("p",{children:"Nombre:"})," ",r.name,s.jsxs("select",{defaultValue:r.role||"default",onChange:h=>this.handleRoleOnChange(r.name,h.target.value),children:[s.jsx("option",{value:"default",children:r.role}),s.jsx("option",{value:"admins",children:"Administrador de Ventas"}),s.jsx("option",{value:"productsmanagers",children:"Administrador de Productos"}),s.jsx("option",{value:"deliveryworkers",children:"Repartidor"})]})]},r.uid)):s.jsx("p",{children:"No se encontraron resultados"})}),s.jsx("h3",{children:"Repartidores"}),s.jsx("input",{placeholder:"Buscar",type:"text",onChange:r=>this.handleSearchOnChangeOnRoles("deliveryworkers",r.target.value)}),s.jsx("ul",{children:this.state.filteredDeliveryWorkers.length>0?this.state.filteredDeliveryWorkers.map(r=>s.jsxs("li",{style:{position:"relative"},children:[s.jsx("p",{children:"UID:"})," ",r.uid," ",s.jsx("p",{children:"Nombre:"})," ",r.name,s.jsxs("select",{defaultValue:r.role||"default",onChange:h=>this.handleRoleOnChange(r.name,h.target.value),children:[s.jsx("option",{value:"default",children:r.role}),s.jsx("option",{value:"admins",children:"Administrador de Ventas"}),s.jsx("option",{value:"productsmanagers",children:"Administrador de Productos"}),s.jsx("option",{value:"deliveryworkers",children:"Repartidor"})]}),r.role==="Repartidor"&&s.jsxs(s.Fragment,{children:[s.jsx("select",{onChange:h=>this.handleStateSelection(h.target.value),children:this.state.states.map(h=>s.jsx("option",{value:h,children:h},h))}),s.jsxs("select",{onChange:h=>this.handleZoneSelection(h.target.value),children:[s.jsx("option",{value:"",children:"Selecciona una zona"}),this.state.zones.map(h=>s.jsx("option",{value:h,children:h},h))]})]}),s.jsx("ul",{children:this.state.municipalities.map(h=>s.jsx("li",{children:h},h))})]},r.uid)):s.jsx("p",{children:"No se encontraron resultados"})})]}),Ie&&s.jsxs("div",{className:"confirmation-dialog",children:[s.jsx("p",{children:"¿Estás seguro de borrar este producto?"}),s.jsx("button",{onClick:()=>this.handleDeleteProduct(this.state.selectedProductId),className:"confirm-button",children:"SEGURO"}),s.jsx("button",{onClick:()=>this.setState({sureToDeleteThisProductMessage:!1}),className:"cancel-button",children:"CANCELAR"})]})]})}}const Ze=()=>{const[S,y]=A.useState([]),[t,a]=A.useState(0);A.useEffect(()=>{(async()=>{const f=j(u,"products"),k=(await v(f)).docs.map(C=>C.data());y(k)})()},[]);const o=Math.ceil(S.length/3),i=()=>{a(n=>n===0?o-1:n-1)},l=()=>{a(n=>n===o-1?0:n+1)},d=n=>{window.location.href=`./product${n}/index.html`};return s.jsxs("section",{className:"content-section",children:[s.jsxs("div",{className:"carousel-header",children:[s.jsx("h1",{children:"¿QUIERES UN PELO ABENDET?"}),s.jsx("h3",{children:"¡DESCUBRE LA TRANSFORMACIÓN QUE TU CABELLO HA ESTADO ESPERANDO CON NUESTRA VARIEDAD DE SHAMPOOS!"})]}),s.jsxs("div",{className:"carousel-container",children:[s.jsx("button",{className:"carousel-btn prev",onClick:i,children:"❮"}),s.jsx("div",{className:"image-container",style:{transform:`translateX(-${t*100}%)`},children:S.map((n,f)=>s.jsxs("div",{className:"product",onClick:()=>d(n.productId),children:[s.jsx("img",{src:n.imageUrl,className:"shampoo-img",alt:n.name}),s.jsxs("div",{className:"product-info",children:[s.jsx("h3",{children:n.name}),s.jsx("p",{children:n.description?n.description.substring(0,100)+"...":"Descripción no disponible"}),s.jsx("p",{children:s.jsxs("strong",{children:["$",n.price]})})]})]},f))}),s.jsx("button",{className:"carousel-btn next",onClick:l,children:"❯"})]})]})},Ke=()=>{const[S,y]=A.useState(!1);A.useEffect(()=>{const a=()=>{window.scrollY>50&&y(!0)};return window.addEventListener("scroll",a),()=>{window.removeEventListener("scroll",a)}},[]);function t(){window.location.href="product2/index.html"}return s.jsxs("div",{className:`scroll-image-container ${S?"show":""}`,children:[s.jsx("img",{src:"../../src/assets/head-and.webp",alt:"Special",className:"scroll-image"}),s.jsx("h3",{children:"FRESCURA EN CADA LAVADO, ALIVIO SIN COMPROMISOS"}),s.jsx("button",{onClick:t,children:"Conocer más"})]})},Ge=()=>{const[S,y]=A.useState(!1);A.useEffect(()=>{const a=()=>{window.scrollY>550&&y(!0)};return window.addEventListener("scroll",a),()=>{window.removeEventListener("scroll",a)}},[]);function t(a){switch(a.target.textContent){case"CASPA":window.location.href="caspa/index.html";break;case"BRILLO":window.location.href="brillo/index.html";break;case"ALISAMIENTO":window.location.href="alisamiento/index.html";break;case"REVITALIZACIÓN":window.location.href="revitalizacion/index.html";break;case"HIDRATACIÓN":window.location.href="hidratacion/index.html";break}}return s.jsxs("div",{className:`scroll-container  ${S?"show":""}`,children:[s.jsx("div",{className:"condition first",onClick:t,children:"CASPA"}),s.jsx("div",{className:"condition second",onClick:t,children:"BRILLO"}),s.jsx("div",{className:"condition third",onClick:t,children:"ALISAMIENTO"}),s.jsx("div",{className:"condition fourth",onClick:t,children:"REVITALIZACIÓN"}),s.jsx("div",{className:"condition fifth",onClick:t,children:"HIDRATACIÓN"})]})};Ue.createRoot(document.getElementById("root")).render(s.jsxs(p.StrictMode,{children:[s.jsx(Qe,{}),s.jsx(Ze,{}),s.jsx(Ke,{}),s.jsx(Ge,{})]}));
